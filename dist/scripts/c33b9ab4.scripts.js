"use strict";angular.module("newsGameApp",["ngCookies","ngResource","ngSanitize","ngRoute","kendo.directives","duScroll","ngAnimate","ipCookie","ngStorage"]).config(["config","$routeProvider",function(config,$routeProvider){$routeProvider.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/intro/:debug?",{templateUrl:"views/intro.html",controller:"IntroCtrl",resolve:{load:function($route,dataService){return dataService.load("all")}}}).when("/play/:debug?",{templateUrl:"views/play.html",controller:"PlayCtrl",resolve:{load:function($route,dataService){return dataService.load("all")}}}).when("/outro/:debug?",{templateUrl:"views/outro.html",controller:"OutroCtrl",resolve:{load:function($route,dataService){return dataService.load("all")}}}).when("/score/:debug?",{templateUrl:"views/score.html",controller:"ScoreCtrl",resolve:{load:function($route,dataService){return dataService.load("all")}}}).otherwise({redirectTo:"/"})}]),angular.module("newsGameApp").constant("prod",!0),angular.module("newsGameApp").constant("config",{baseurl:"",seoTitle:"Chasseur d'infos",sounds:{click:"sounds/click",endGame:"sounds/end_game",endLoose:"sounds/end_loose",endWin:"sounds/end_win",feedbackBad:"sounds/feedback_bad",feedbackGood:"sounds/feedback_good",home:"sounds/home",introText:"sounds/intro_text",schoolBell:"sounds/school_bell",skoupeMsg:"sounds/skoupe_msg",skoupeText:"sounds/skoupe_text",verification:"sounds/verification"}}),angular.module("newsGameApp").factory("dataService",["$http","$q","config",function($http,$q,config){return{data:{},load:function(id){var defer=$q.defer(),data=this.data;return $http.get(config.baseurl+"/data/settings.json").success(function(response){data.settings=response,$http.get(config.baseurl+"/data/"+id+".json").success(function(response){data[id]=response,defer.resolve(response)})}),defer.promise}}}]),angular.module("newsGameApp").factory("titleService",["$document",function($document){var suffix,title;return suffix=title="",{setSuffix:function(s){return suffix=s},getSuffix:function(){return suffix},setTitle:function(t){return title=""!==suffix?t+suffix:t,title+=" | Chasseur d'infos",$document.prop("title",title)},getTitle:function(){return $document.prop("title")}}}]),angular.module("newsGameApp").factory("utils",function(){return{shuffle:function(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}}}).filter("reverse",function(){return function(items){return items.slice().reverse()}}),angular.module("newsGameApp").filter("duration",function(){return function(input){var hours=Math.floor(input/60),minutes=input%60,result="";return hours&&(result=hours+" heure"+(hours>1?"s":"")),minutes&&(result+=" "+minutes+" minutes"),result}}).filter("time",function(){return function(input){var hours=Math.floor(input/60),minutes=input%60,result="";return hours&&(result=hours+" h"),minutes&&(result+=" "+minutes+" m"),result}}).filter("removeAT",function(){return function(input){return"undefined"==typeof input?"":input.replace("@","")}}),angular.module("newsGameApp").controller("HomeCtrl",["$rootScope","$scope","$localStorage","$log","$location","$timeout","prod","titleService","Xiti","Sound",function($rootScope,$scope,$localStorage,$log,$location,$timeout,prod,titleService,Xiti,Sound){$log.debug("Home"),Sound.init(),Sound.sounds.home=new buzz.sound("sounds/home"),(prod||!Sound.muteDev)&&Sound.play("home"),$rootScope.background="home",titleService.setTitle("Accueil"),$scope.$storage=$localStorage.$default({level:1,scores:{}}),$scope.newGame=function(){$log.debug("newGame"),Sound.play("click"),$localStorage.$reset(),$log.debug($scope.$storage),$log.debug($scope.$storage.chosenTheme),$scope.$storage.level=1,$location.path("/intro")},Xiti.click(null,"Serious Game::home"),$log.debug($scope.$storage.level),$log.debug($scope.$storage.scores),$timeout(function(){jQuery("#credits, .bt-close-splash").on("click",function(event){jQuery("#credits-body").toggleClass("ng-hide"),event.preventDefault()})},1e3)}]),angular.module("newsGameApp").controller("IntroCtrl",["$rootScope","$scope","$routeParams","$log","$location","$timeout","$interval","$q","dataService","titleService","Xiti","Sound","utils","$localStorage",function($rootScope,$scope,$routeParams,$log,$location,$timeout,$interval,$q,dataService,titleService,Xiti,Sound,utils,$localStorage){function doSteps(){var step=null;angular.forEach(steps,function(v){step=null===step?v[1]():step.then(function(){return v[1]()})})}function addStep(delay,callback){steps.push([delay,callback])}function addChat(delay,speaker,content,speakerName){addStep(delay,function(){return $scope.character=speaker,speakerName&&($scope.characterName=speakerName),showText(content)})}function showText(content){$log.debug("showText(",content);var deferred=$q.defer(),contentIdx=0;$scope.typed="",$scope.skipText=1;var interval=$interval(function(){0===$scope.skipText&&($scope.typed=$scope.typed+content[contentIdx],contentIdx+=1,contentIdx===content.length&&$scope.skipText++),1===$scope.skipText&&($scope.typed=content,$scope.skipText=2,$timeout(function(){$scope.skipText=3},chatDelay*delayModifier)),3===$scope.skipText&&($interval.cancel(interval),deferred.resolve())},chatInterval*delayModifier);return deferred.promise}function scenario(){scenarii["level"+$scope.$storage.level]&&scenarii["level"+$scope.$storage.level]()}$log.debug("Intro"),titleService.setTitle("Intro"),Sound.init(),$log.debug(Sound.sounds),Sound.play("introText"),$scope.debug=$routeParams.debug,$scope.$storage=$localStorage.$default({level:1,scores:{}}),Xiti.click(null,"Serious Game::intro::level-"+$scope.$storage.level),$scope.themes=dataService.data.all.themes,$rootScope.background="intro-level-"+$scope.$storage.level;var chatDelay=dataService.data.settings.chatDelay,chatInterval=dataService.data.settings.chatInterval,delayModifier=$scope.debug?.1:2,steps=[];$scope.skipText=0,$scope.skipCurrentText=function(){$scope.skipText++};var scenarii={};scenarii.level1=function(){$log.debug(">scenario1"),steps=[];var interlocutor="Daniel";addChat(chatDelay,"me","Hé ! Salut","Moi"),addChat(chatDelay,interlocutor+"3","Ah, salut !","Mehdi"),addChat(chatDelay,"me","T’as passé un bon week-end ? Tu as trouvé ce que tu allais mettre sur ta fiche d’orientation ?","Moi"),addChat(chatDelay,interlocutor+"3","Pffft ! Pas du tout. Comment on est censés savoir ce qu’on voudra faire plus tard... Et toi, t’as une idée ?","Mehdi"),"stop"!==$routeParams.debug&&(addChat(chatDelay,"me","Non, pas trop. Tu fais quoi avec ton aïePhone ? Tu admires tes selfies du week-end ?","Moi"),addChat(chatDelay,interlocutor+"3","Ah non, plus sérieux que ça ! Je checkais ma timeline sur Cuicuitter !","Mehdi"),addChat(chatDelay,"me","Tu quoi ta quoi sur kuikuiquoi ? J’ai rien compris !","Moi"),addChat(chatDelay,interlocutor+"3","Attends, je vais te montrer... Tu vas voir, c’est génial !","Mehdi"),addStep(chatDelay,function(){Sound.play("schoolBell")}),addChat(chatDelay,interlocutor+"3","Arf, faut aller en cours. Bon c’est pas grave : ce soir, t’allumes ton ordi, tu me captes sur Skoupe et je t’expliquerai.","Mehdi"),addChat(chatDelay,"me","Ok, super&nbsp;! A ce soir&nbsp;!","Moi"),addChat(chatDelay,interlocutor+"3","A plus&nbsp;!","Mehdi"),addStep(chatDelay,function(){$log.debug(Sound.playing),Sound.playing&&Sound.sounds[Sound.playing].fadeOut(500),$location.path("/play")}))},scenarii.level2=function(){$log.debug(">scenario2"),steps=[],addStep(2500,function(){$location.path("/play")})},scenarii.level3=function(){$log.debug(">scenario3"),steps=[];for(var mandatory=null;!mandatory||mandatory===$scope.$storage.chosenTheme;)mandatory=utils.shuffle(Object.keys(dataService.data.all.themes))[0],$log.debug(mandatory,$scope.$storage.chosenTheme);$scope.$storage.mandatoryTheme=mandatory;var interlocutor="SoniaA";addChat(chatDelay,interlocutor+"3","Bonjour et bienvenue chez L’International ! Pas trop tendu(e) pour ta première journée ?","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Heu... un peu, si !","moi"),addChat(chatDelay,interlocutor+"3","C’est vrai que nous sommes un site d’informations très populaire... Mais ne vous en faites pas, ça va aller. Avec votre blog, vous avez montré que vous saviez sélectionner une information. C’est une bonne base !","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Merci ! Je compte faire de mon mieux !","moi"),addChat(chatDelay,interlocutor+"3","Ici, vous allez continuer à vous occuper de "+$scope.themes[$scope.$storage.chosenTheme]+". Mais attention, ce n’est pas tout ! Je vous charge aussi de trouver des infos sur "+$scope.themes[$scope.$storage.mandatoryTheme]+" !","Sonia, rédactrice en chef"),addChat(chatDelay,"me",""+$scope.themes[$scope.$storage.mandatoryTheme]+" ? Ok, c'est noté !","moi"),addChat(chatDelay,interlocutor+"3","Et ce n’est pas tout ! Nos lecteurs DÉTESTENT qu’on leur donne de mauvaises infos.","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Je comprends...","moi"),addChat(chatDelay,interlocutor+"3","Du coup, vous allez devoir apprendre à VÉRIFIER vos informations. Vous savez comment faire ?","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Hum... Non.","moi"),addChat(chatDelay,interlocutor+"3","Alors connectez-vous sur votre ordi, je vais vous montrer.","Sonia, rédactrice en chef"),addStep(chatDelay,function(){$location.path("/play")})},scenarii.level4=function(){$log.debug(">scenario4"),steps=[];var interlocutor="SoniaB";addChat(chatDelay,interlocutor+"3","Ah vous voilà ! Je vous attendais !","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Oups... Qu’est-ce qui se passe, chef, j’ai fait une bêtise ?","moi"),addChat(chatDelay,interlocutor+"3","Au contraire ! Vous vous débrouillez très bien ! Alors comme je pars en vacances ce matin, j’ai pensé que vous alliez me remplacer !","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Ah bon ?!! Mais je... Heu...","moi"),addChat(chatDelay,interlocutor+"3","Mais si, mais si, vous allez vous en sortir ! Il y a seulement deux règles à connaître !","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Ah ? Lesquelles ?","moi"),addChat(chatDelay,interlocutor+"3","La première : les gens aiment qu’on leur parle de tout ! Vous devez donc essayer de publier des infos qui portent sur chacune des six thématiques existantes !","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Ah. Ca, c’est plutôt bien : je ne suis plus obligé de chercher seulement les infos parlant de "+$scope.themes[$scope.$storage.chosenTheme]+" et "+$scope.themes[$scope.$storage.mandatoryTheme]+"...","moi"),addChat(chatDelay,interlocutor+"3","Eh non. Mais attention à la règle numéro 2 : il faut HIÉRARCHISER l’information !","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Hiérarchi... quoi ?","moi"),addChat(chatDelay,interlocutor+"3","Pffff... Bon, connectez-vous sur mon ordinateur, je vais vous montrer en utilisant ma tablette. Allez, je vous laisse, je me connecte dès que je suis dans le taxi. A bientôôôôôôt !","Sonia, rédactrice en chef"),addChat(chatDelay,"me","Mais... attendez, je... Ah, elle est partie.","moi"),addStep(chatDelay,function(){$location.path("/play")})},scenario(),$timeout(function(){$scope.fadeSplash=!0,$timeout(function(){doSteps()},chatDelay*delayModifier)},4e3+chatDelay*delayModifier)}]),angular.module("newsGameApp").controller("PlayCtrl",["$document","$rootScope","$scope","$routeParams","$location","$log","prod","$timeout","$interval","dataService","titleService","Xiti","Sound","utils","$localStorage",function($document,$rootScope,$scope,$routeParams,$location,$log,prod,$timeout,$interval,dataService,titleService,Xiti,Sound,utils,$localStorage){function applySourceTheme(){angular.forEach($scope.cuits,function(cuit,id){var source=dataService.data.all.sources[$scope.cuits[id].source];source&&source.themeVerified&&($scope.cuits[id].author=dataService.data.all.sources[cuit.source],$scope.cuits[id].themeVerified=!0)})}function applySourceCredibility(){angular.forEach($scope.cuits,function(cuit,id){var source=dataService.data.all.sources[$scope.cuits[id].source];source&&source.credibilityVerified&&($scope.cuits[id].author=dataService.data.all.sources[cuit.source],$scope.cuits[id].credibilityVerified=!0)})}function addCuit(next,force,author,theme,sources,credibility){if($log.debug("addCuit",next,force,author,theme,credibility),!force&&$scope.skipCuits)$timeout(function(){addCuit(!0)},(Math.random()*chatDelay+1800)*delayModifier);else{var added=!1,cuits=utils.shuffle(Object.keys(dataService.data.all.cuits));angular.forEach(cuits,function(cuitIdx){var cuit=dataService.data.all.cuits[cuitIdx];added||-1!==$scope.allCuits.indexOf(cuitIdx)||(!author&&!theme&&!sources&&void 0===credibility||cuit.source===author||cuit.theme===theme||sources&&sources.indexOf(cuit.source)>-1||cuit.credibility===credibility)&&(cuit.author=dataService.data.all.sources[cuit.source],cuit.author&&(cuit.themeVerified=cuit.author.themeVerified),cuit.scoop=Math.random()<cuit.exclusivity,cuit.visible=!1,!$scope.cuitsHover&&!$scope.newCuits||force?$timeout(function(){cuit.visible=!0},1):$scope.newCuits=!0,$scope.allCuits.push(cuitIdx),$scope.cuits.unshift(cuit),added=!0,applySourceTheme(),applySourceCredibility(),next&&$timeout(function(){addCuit(!0)},Math.random()*chatDelay*delayModifier+1800),selectedCuit=cuit)})}}function updateCuitCredibility(force){$log.debug("updateCuitCredibility(",force);var details=["J'ai fait quelques recherches et cette info est complètement bidon. Je vous déconseille de la publier !","Cette info n'est pas vraiment crédible. Ne la publiez que si vous n'avez rien d'autre.","Cette info est crédible. Vous pouvez la publier sans souci !","Ah ! Voilà une super info ! Très crédible et intéressante… Foncez, publiez-la !"];force||-1!==selectedContact.themes.indexOf(selectedCuit.theme)?(decrementTime("verify-cuit-credibility","skoupe",details[selectedCuit.credibility],selectedCuit.credibility),selectedCuit.credibilityVerified=!0,force||Sound.play(selectedCuit.credibility>1?"feedbackGood":"feedbackBad")):decrementTime("verify-cuit-credibility","skoupe","Je ne peux rien vous dire sur cette info… Sa thématique n'est pas ma spécialité."),$scope.selectedCuit=null,$scope.skipCuits=!1,$scope.canCall=!1,contactVerify(force)}function updateCuitExclusivity(){$log.debug("updateCuitExclusivity"),-1!==selectedContact.themes.indexOf(selectedCuit.theme)?(Sound.play(selectedCuit.scoop?"feedbackGood":"feedbackBad"),decrementTime("verify-cuit-exclusivity","skoupe",selectedCuit.scoop?"Incroyable ! Vous avez déniché un scoop ! Si cette info est crédible, publiez-la absolument !":"Ah… Cette info n'est pas un scoop. Mais si elle est crédible, elle intéressera peut-être vos lecteurs.",selectedCuit.scoop?1:0),selectedCuit.exclusivityVerified=!0,angular.forEach($scope.cuits,function(cuit,id){cuit.id===selectedCuit.id&&($scope.cuits[id].exclusivityVerified=!0)})):decrementTime("verify-cuit-credibility","skoupe","Je ne peux pas vous dire si cette info est un scoop… Sa thématique n'est pas ma spécialité.",-1),$scope.selectedCuit=null,$scope.skipCuits=!1,$scope.canCall=!1,contactVerify()}function contactVerify(force){Sound.play("click");var added=!1;angular.forEach($scope.$storage.contacts,function(contact,key){added||!force&&contact.id!==selectedContact.id||($log.debug(contact.verifiedCuits),contact.verifiedCuits||($scope.$storage.contacts[key].verifiedCuits=[]),$log.debug(contact.themes.indexOf(selectedCuit.theme)),$log.debug(contact.verifiedCuits.indexOf(selectedCuit.id)),-1!==contact.themes.indexOf(selectedCuit.theme)&&-1===contact.verifiedCuits.indexOf(selectedCuit.id)&&($log.debug("added"),$scope.$storage.contacts[key].verifiedCuits.push(selectedCuit.id),added=!0))})}function addContact(theme){$log.debug("addContact(",theme);var contacts=utils.shuffle(Object.keys(dataService.data.all.contacts)),added=!1;angular.forEach(contacts,function(contactIdx){var contact=dataService.data.all.contacts[contactIdx];added||-1!==$scope.$storage.allContacts.indexOf(contactIdx)||theme&&-1===contact.themes.indexOf(theme)||(contact.verifiedCuits=[],$scope.$storage.allContacts.push(contactIdx),$scope.$storage.contacts.unshift(contact),added=!0)})}function checkRemainingTime(action){var duration=dataService.data.settings.actionsCost[action];return $scope.remainingTime>duration}function decrementTime(action,type,detail,extra){$log.debug("decrementTime(",action,type,detail,extra);var duration=dataService.data.settings.actionsCost[action];if($scope.tuto)decrementedTime(duration);else{$scope.waiting.active=!0,$scope.waiting.action=action,$scope.waiting.type=type,$scope.waiting.extra=extra,$scope.waiting.detail=detail,$scope.waiting.duration=duration,$scope.waiting.level=0,$log.debug($scope.waiting);var stop;stop=$interval(function(){$scope.waiting.level<100?$scope.waiting.level+=1:($interval.cancel(stop),stop=void 0,$timeout(function(){decrementedTime(duration)},1e3))},1*duration)}}function decrementedTime(duration){$scope.waiting.active=!1,$scope.remainingTime-=duration,$scope.remainingTime/$scope.totalTime<=.75&&($scope.gaugeLevel="lightgreen"),$scope.remainingTime/$scope.totalTime<=.5&&($scope.gaugeLevel="yellow"),$scope.remainingTime/$scope.totalTime<=.25&&($scope.gaugeLevel="orange"),$scope.remainingTime/$scope.totalTime<=.15&&($scope.gaugeLevel="red"),jQuery(".timeline").css({"z-index":99999}),$timeout(function(){jQuery(".timeline").css({"z-index":999})},2e3),$log.debug($scope.remainingTime," <= ",$scope.totalTime/2),$scope.remainingTime+duration>$scope.totalTime/2&&$scope.remainingTime<=$scope.totalTime/2,$scope.remainingTime+duration>$scope.totalTime/4&&$scope.remainingTime<=$scope.totalTime/4,$scope.remainingTime<=0&&promptEndDay()}function promptEndDay(){$scope.promptNoCancel=!0,promptCallback=function(){$log.debug("endDay"),$scope.closeWin("prompt"),promptCallback=null,doEndDay()},$scope.promptContent="Votre journée est terminée.<br />Avez-vous bien travaillé ?",$scope.openWin("promptEndDay")}function createWindow(id,args){$scope.windows[id]=angular.extend({visible:!1,active:!0,actions:["Close"],resizable:!1,modal:!1,width:400,height:400,position:{top:300,left:300}},args),$timeout(function(){jQuery("#"+id).data("kendoWindow").bind("activate",function(){jQuery("#"+id).parent().attr("id","win-"+id)})},50)}function doSteps(){var step=null;angular.forEach(steps,function(v){step=null===step?$timeout(v[1],v[0]*delayModifier):step.then(function(){return $timeout(v[1],v[0]*delayModifier)})})}function addStep(delay,callback){steps.push([delay,callback])}function addChat(delay,speaker,content){addStep(delay,function(){$scope.openWin("chat"),"other"!==speaker&&Sound.play("skoupeText"),$scope.currentChat.status="other"===speaker?"reading":"writing";var $container=angular.element(document.getElementById("chat-scroll")),chatBottom=angular.element(document.getElementById("chat-bottom"));$container.scrollToElement(chatBottom,30,100)}),addStep(delay-400,function(){$scope.currentChat.discussion.push({speaker:speaker,content:content}),$scope.currentChat.status="",$timeout(function(){var $container=angular.element(document.getElementById("chat-scroll")),chatBottom=angular.element(document.getElementById("chat-bottom"));$container.scrollToElement(chatBottom,30,100)},50)})}function endTuto(){$log.debug("endTuto"),$scope.skipCuits=!1,$scope.tuto=!1,tutoAction=null}function scenario(){scenarii["level"+$scope.level]&&($scope.tuto=!0,scenarii["level"+$scope.level]())}function fake(){fakes["level"+$scope.level]&&fakes["level"+$scope.level]()}function play(){plays["level"+$scope.level]&&plays["level"+$scope.level]()}function doPublishCuit(cuit){$log.debug("publishCuit(",cuit);var post={cuit:cuit,title:cuit.articleTitle,date:Math.floor(($scope.totalTime-$scope.remainingTime)/$scope.remainingTime*10*60)+480};angular.forEach($scope.cuits,function(c,idx){c.id===cuit.id&&($scope.cuits[idx].published=!0)}),$scope.posts.push(post),$scope.openWin(4===$scope.level?"publish":"blog"),decrementTime("publish-cuit","publish"),updateFeedback(post),updateScore(),$scope.tooltip.active=!1,$scope.closeWin("prompt"),promptCallback=null}function updateFeedback(post){2===$scope.level&&(post.cuit.theme===$scope.$storage.chosenTheme?feedback("good",dataService.data.settings.messages["level-2"]["feedback-good-theme"]):feedback("bad",dataService.data.settings.messages["level-2"]["feedback-wrong-theme"])),3===$scope.level&&($log.debug([$scope.$storage.chosenTheme,$scope.$storage.mandatoryTheme],post.cuit.theme),-1!==[$scope.$storage.chosenTheme,$scope.$storage.mandatoryTheme].indexOf(post.cuit.theme)?post.cuit.credibility>1?feedback("good",dataService.data.settings.messages["level-3"]["feedback-good-theme"]):feedback("bad",dataService.data.settings.messages["level-3"]["feedback-bad-credibility"]):feedback("bad",dataService.data.settings.messages["level-3"]["feedback-wrong-theme"]))}function feedback(type,detail){$log.debug("feedback(",type,detail),$scope.feedback.type=type,"good"===type&&(Sound.play("feedbackGood"),$scope.feedback.status="Vos lecteurs vont aimer cette publication !"),"bad"===type&&(Sound.play("feedbackBad"),$scope.feedback.status="Vos lecteurs ne vont aimer pas cette publication !"),$scope.feedback.detail=detail,$scope.feedback.active=!0,$timeout(function(){$scope.feedback.active=!1},4e3)}function doEndDay(){$scope.skipCuits=!0,scenarii["level"+$scope.level+"End"]()}function showScoring(){updateScore(),$rootScope.posts=$scope.posts,$rootScope.scoreStatus=$scope.scoreStatus,$location.path("/outro")}function updateScore(){var score=$scope.score?$scope.score:0,scoring=$scope.scoring["level-"+$scope.level];if(1===$scope.level&&($scope.scoreStatus="victory"),2===$scope.level&&angular.forEach($scope.posts,function(post,idx){post.cuit.theme===$scope.$storage.chosenTheme?(score+=scoring["select-cuit-in-correct-theme"],$scope.posts[idx].score=scoring["select-cuit-in-correct-theme"]):(score+=scoring["select-cuit-in-wrong-theme"],$scope.posts[idx].score=scoring["select-cuit-in-wrong-theme"])}),3===$scope.level&&angular.forEach($scope.posts,function(post,idx){-1===[$scope.$storage.chosenTheme,$scope.$storage.mandatoryTheme].indexOf(post.cuit.theme)?(score+=scoring["select-cuit-in-wrong-theme"],$scope.posts[idx].score=scoring["select-cuit-in-wrong-theme"]):(score+=scoring["select-cuit-in-correct-theme-credibility-"+post.cuit.credibility],$scope.posts[idx].score=scoring["select-cuit-in-correct-theme-credibility-"+post.cuit.credibility])}),4===$scope.level){var base,multiplier,cuitScore,themes=[];angular.forEach($scope.posts,function(post,idx){$log.debug(idx,post.cuit.id,post.cuit.credibility,post.cuit.scoop),base="select-cuit-credibility-"+post.cuit.credibility,post.cuit.credibility>0&&(base+=post.cuit.scoop?"-exclusive":"-not-exclusive"),multiplier=scoring["cuit-position"][idx],cuitScore=scoring[base]*multiplier,score+=cuitScore,-1===themes.indexOf(post.cuit.theme)&&themes.push(post.cuit.theme),$log.debug(base,multiplier,cuitScore),$scope.posts[idx].score=cuitScore}),$log.debug(themes),score*=themes.length}$log.debug("score : "+score),$scope.scoreStatus=scoring?0===score?"defeat":score>=$scope.scoring["level-"+$scope.level]["winning-score"]?"victory":"defeat":"victory",$scope.$storage.scores["level-"+$scope.level]=score,$scope.$storage.posts=$scope.posts,$scope.$storage.scoreStatus=$scope.scoreStatus,$scope.scoreLevel="green",$scope.scoring["level-"+$scope.level]&&($scope.scoring["level-"+$scope.level]["winning-score"]/score<=.15&&($scope.scoreLevel="lightgreen"),$scope.scoring["level-"+$scope.level]["winning-score"]/score<=.25&&($scope.scoreLevel="yellow"),$scope.scoring["level-"+$scope.level]["winning-score"]/score<=.5&&($scope.scoreLevel="orange"),$scope.scoring["level-"+$scope.level]["winning-score"]/score<=.75&&($scope.scoreLevel="red")),$log.debug($scope.scoreLevel)}$scope.debug="debug"===$routeParams.debug,$scope.fake="fake"===$routeParams.debug,$scope.skip="skip"===$routeParams.debug,$scope.fast="fast"===$routeParams.debug,Sound.init(),$scope.$storage=$localStorage.$default({level:1,scores:{}}),titleService.setTitle("Play"),Xiti.click(null,"Serious Game::play::level-"+$scope.$storage.level);var delayModifier=($scope.debug?.05:1)*("fast"===$routeParams.debug?.5:1),chatDelay=dataService.data.settings.chatDelay;$scope.windows={},$scope.level=$scope.$storage.level,$scope.scoring=dataService.data.settings.scoring,$scope.totalTime=$scope.remainingTime=dataService.data.settings.totalTime["level-"+$scope.level],$scope.themes=dataService.data.all.themes,$scope.actionsCost=dataService.data.settings.actionsCost,$scope.selectedTheme=null,$scope.showScoring=!1,$rootScope.background="play-level-"+$scope.level,$scope.allCuits=[],$scope.cuits=[];var openSourceThemeCallback=!1;$scope.openSource=function(id){Sound.play("click"),$scope.closeWin("source"),$scope.currentSource=dataService.data.all.sources[id],$scope.openWin("source"),openSourceThemeCallback&&openSourceThemeCallback()};var verifySourceThemeCallback=!1;$scope.verifySourceTheme=function(id){(!tutoAction||verifySourceThemeCallback)&&(checkRemainingTime("verify-source-theme")||tutoAction)&&(Sound.play("click"),dataService.data.all.sources[id].themeVerified=!0,$scope.currentSource=dataService.data.all.sources[id],decrementTime("verify-source-theme","verify"),applySourceTheme(),verifySourceThemeCallback&&verifySourceThemeCallback())};var verifySourceCredibilityCallback=!1;$scope.verifySourceCredibility=function(id){(!tutoAction||verifySourceCredibilityCallback)&&checkRemainingTime("verify-source-credibility")&&(Sound.play("click"),dataService.data.all.sources[id].credibilityVerified=!0,$scope.currentSource=dataService.data.all.sources[id],decrementTime("verify-source-credibility","verify"),applySourceCredibility(),verifySourceCredibilityCallback&&verifySourceCredibilityCallback())},$scope.cuitsHover=!1,$scope.cuitsOver=function(){$scope.cuitsHover=!0},$scope.cuitsOut=function(){$timeout(function(){$scope.cuitsHover=!1},1e3)},$scope.addCuit=addCuit,$scope.showCuits=function(click){$log.debug("showCuits"),click&&Sound.play("click"),angular.forEach($scope.cuits,function(cuit){cuit.visible===!1&&($log.debug("show",cuit),cuit.visible=!0)}),$scope.newCuits=!1};var verifyCuitThemeCallback=!1;$scope.verifyCuitTheme=function(cuit){(!tutoAction||verifyCuitThemeCallback)&&(checkRemainingTime("verify-cuit-theme")||tutoAction)&&(Sound.play("verification"),$log.debug("verifyCuitTheme("+cuit),selectedCuit=cuit,cuit.themeVerified=!0,decrementTime("verify-cuit-theme","verify"),verifyCuitThemeCallback&&verifyCuitThemeCallback())};var verifyCuitCredibilityCallback=!1;$scope.verifyCuitCredibility=function(cuit){(!tutoAction||verifyCuitCredibilityCallback)&&checkRemainingTime("verify-cuit-credibility")&&(Sound.play("verification"),selectedCuit=cuit,$scope.selectedCuit=selectedCuit,$scope.skipCuits=!0,$scope.canCall=!0,$scope.openWin("skoupe"),callContactAction=updateCuitCredibility,verifyCuitCredibilityCallback&&(verifyCuitCredibilityCallback(),verifyCuitCredibilityCallback=null))};var verifyCuitExclusivityCallback=!1;$scope.verifyCuitExclusivity=function(cuit){checkRemainingTime("verify-cuit-exclusivity")&&($log.debug("verifyCuitExclusivity("+cuit),Sound.play("verification"),selectedCuit=cuit,$scope.selectedCuit=selectedCuit,$scope.skipCuits=!0,$scope.canCall=!0,$scope.openWin("skoupe"),callContactAction=updateCuitExclusivity,verifyCuitExclusivityCallback&&(verifyCuitExclusivityCallback(),verifyCuitExclusivityCallback=null))},$scope.$storage.contacts||($scope.$storage.contacts=[]),$scope.$storage.allContacts||($scope.$storage.allContacts=[]),$scope.currentContact=null;var newContactCallback;$scope.newContact=function(){Sound.play("click"),$scope.openWin("themeSelector"),$scope.themeSelectorAction=function(){addContact($scope.selectedTheme),$scope.closeWin("themeSelector"),$scope.themeSelectorAction=null},newContactCallback&&(newContactCallback(),newContactCallback=null)},$scope.openContact=function(id){Sound.play("click"),$scope.closeWin("contact"),$scope.currentContact=$scope.$storage.contacts[id],$scope.openWin("contact")};var callContactCallback,callContactAction,selectedContact;$scope.canCall=!1,$scope.callContact=function(contact){Sound.play("click"),$log.debug("callContact(",contact.id),selectedContact=contact,callContactAction&&(callContactAction(),callContactAction=null),callContactCallback&&(callContactCallback(),callContactCallback=null)},$scope.currentChat=null,$scope.openChat=function(id){Sound.play("click"),$scope.closeWin("chat"),$scope.currentchatContact=$scope.chat[id],$scope.openWin("chat")},$scope.gaugeLevel="green",$scope.waiting={active:!1};var promptCallback;$scope.promptCancel=function(){promptCallback=null,$scope.closeWin("prompt")},$scope.promptConfirm=function(){promptCallback&&promptCallback()},$scope.tooltip={active:!1,content:"Quisque id neque scelerisque velit.",_pos:{},position:function($elt,top,left){$elt&&(this._pos={elt:$elt,top:top,left:left}),this._pos.elt&&jQuery("#tooltip").css({top:this._pos.elt.offset().top+this._pos.top,left:this._pos.elt.offset().left+this._pos.left})}},$interval(function(){$scope.tooltip.position()},50),$scope.toggleWin=function(id){Sound.play("click"),$scope.windows[id].visible?$scope.closeWin(id):$scope.openWin(id)},$scope.openWin=function(id,options){$log.debug("openWin(",id),$scope.windows[id].visible||(jQuery("#"+id).data("kendoWindow")&&jQuery("#"+id).data("kendoWindow").open(),$scope.setOptionsWin(id,{dragend:function(){$scope.tooltip.position()}}),"chat"===id&&Sound.play("skoupeMsg")),jQuery("#"+id).data("kendoWindow").toFront(),options&&$scope.setOptionsWin(id,options)},$scope.closeWin=function(id){$scope.windows[id].visible&&jQuery("#"+id).data("kendoWindow").close()},$scope.setOptionsWin=function(id,options){jQuery("#"+id).data("kendoWindow").setOptions(options)},createWindow("cuicuiter",{title:"Cuicuiter",visible:!1,template:"cuicuiter-main",height:505,position:{top:35,left:20}}),createWindow("source",{title:"Profil Cuicuiter",active:!1,template:"cuicuiter-source",width:400,height:240,position:{top:125,left:250}}),createWindow("skoupe",{title:"Skoupe",visible:!1,active:!0,template:"skoupe-main",height:200,position:{top:70,left:600}}),createWindow("contact",{title:"Contact",active:!1,visible:!1,template:"skoupe-contact",height:245,position:{top:125,left:550}}),$scope.skip||createWindow("chat",{title:"Conversation",active:!0,template:"skoupe-chat",height:300,position:{top:225,left:600}}),createWindow("notepad",{title:"Bloc-Notes",template:"notepad",visible:!0,active:!0,height:220,position:{top:50,left:450}}),createWindow("themeSelector",{title:"Choix d'une thématique",template:"theme-selector",active:!1,actions:[],modal:!0,height:260,position:{top:250,left:250}}),createWindow("prompt",{title:"Avertissement",template:"prompt",active:!1,actions:[],modal:!0,height:130,width:220,position:{top:"45%",left:"45%"}}),createWindow("promptEndDay",{title:"Avertissement",template:"prompt",active:!1,actions:[],modal:!0,height:150,width:220,position:{top:"45%",left:"45%"}}),2===$scope.level&&createWindow("blog",{title:"Mon blog",active:!0,template:"blog",height:360,width:385,position:{top:250,left:550}}),3===$scope.level&&createWindow("blog",{title:"L'international",active:!0,template:"publish_lite",height:360,width:385,position:{top:250,left:550}}),4===$scope.level&&createWindow("publish",{title:"L'International",active:!0,template:"publish",height:600,width:500,position:{top:150,left:450}});var steps=[];$scope.tuto=!1,$scope.endTuto=endTuto;var scenarii={},tutoAction=null;scenarii.level1=function(){$log.debug(">scenario1"),tutoAction=!0,$scope.currentChat={contact:"Mehdi",discussion:[]},steps=[],addStep(500,function(){$scope.openWin("cuicuiter"),addCuit(!1,!0),addCuit(!1,!0),addCuit(!1,!0),addCuit(!1,!0)}),addStep(chatDelay,function(){$scope.openWin("chat")
}),addChat(chatDelay,"other","Alors, tu as lancé Cuicuitter ?"),addChat(chatDelay,"me","Oui, je viens de le faire, mais je comprends rien... C’est quoi tous ces messages ?"),addChat(chatDelay,"other","Ca s’appelle des « Cuitts » ! C’est des messages très courts. Ils viennent s’afficher dans ta timeline dès que quelqu’un les poste."),addChat(chatDelay,"me","Mais justement, qui les poste ?"),addChat(chatDelay,"other","Tout le monde ! Des stars, des sportifs, des pros de l’économie ou de la politique... Y en a pour tous les goûts ! En gros, il y a six grandes thématiques. Attends, je t’envoie la liste..."),addStep(1500,function(){$scope.openWin("notepad")}),addChat(5500+chatDelay,"me","Ah merci ! Mais... tout ne m’intéresse pas, là-dedans. Tu sais que moi, ma passion, c’est..."),addStep(1500,function(){$scope.closeWin("notepad"),$scope.openWin("themeSelector"),$scope.themeSelectorAction=function(){$log.debug("themeSelectorAction"),$scope.$storage.chosenTheme=$scope.selectedTheme,$scope.$storage.chosenTheme=$scope.$storage.chosenTheme,$scope.closeWin("themeSelector"),scenarii.level1Phase2()}}),addStep(chatDelay,function(){if($scope.debug){var $choices=jQuery("#themeSelector :radio");$choices.eq(Math.round(Math.random()*$choices.length)).click(),jQuery("#themeSelector button").click(),$scope.$storage.chosenTheme="politique"}}),doSteps()},scenarii.level1Phase2=function(){$log.debug(">level1Phase2 : "+$scope.$storage.chosenTheme),steps=[],tutoAction=!0,addChat(500,"me",$scope.themes[$scope.$storage.chosenTheme]+"&nbsp;! Si je veux trouver des infos sur ce sujet-là, je fais comment ?"),addChat(chatDelay,"other","Tu ouvres grands tes yeux... et tu fais marcher ton cerveau ! En lisant les Cuitts, tu pourras déterminer de quoi ils parlent."),addChat(chatDelay,"me","Hum... pas facile !"),addChat(chatDelay,"other","Je vois. Si tu as un doute, tu peux faire une recherche pour vérifier la thématique de chaque Cuitt. Regarde, clique sur celui-ci !"),addStep(chatDelay,function(){$scope.skipCuits=!0,$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Vérifier la thématique</strong>",$scope.tooltip.position(jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".metas .theme button"),50,20),$scope.tooltip.orientation="top left",$scope.tooltip.active=!0,verifyCuitThemeCallback=function(){scenarii.level1Phase3()}}),addStep(chatDelay,function(){$scope.debug}),doSteps()};var selectedCuit;scenarii.level1Phase3=function(){$scope.tooltip.active=!1,verifyCuitThemeCallback=!1,$log.debug(">level1Phase3"),steps=[],addChat(chatDelay,"other","Et voilà ! Tu vois, ça a pris un peu de temps mais ça en valait la peine ! Maintenant, tu sais que ce cuitt parle de "+$scope.themes[selectedCuit.theme]+"."),addChat(chatDelay,"other","Tu vois, c’est signalé par le petit picto qui a remplacé le point d’interrogation en dessous du message !"),selectedCuit.theme===$scope.$storage.chosenTheme?addChat(chatDelay,"me","Ah, géniale, cette info ! Justement ce qui m’intéresse !"):addChat(chatDelay,"me","Ah ouais... Pas mal, cette info, mais, moi, ce qui m’intéresse, c’est "+$scope.themes[$scope.$storage.chosenTheme]+"."),addChat(chatDelay,"other","Ce qui est cool avec Cuicuitter, c’est que je suis sûr qu’en fouillant dans la timeline, tu peux trouver un autre cuit qui parle de "+$scope.themes[$scope.$storage.chosenTheme]+". A toi de jouer !"),addStep(chatDelay,function(){addCuit(!1,!0)}),addStep(chatDelay,function(){$scope.skipCuits=!0,$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Vérifier la thématique</strong>",$scope.tooltip.position(jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".metas .theme button"),50,20),$scope.tooltip.orientation="top left",$scope.tooltip.active=!0,verifyCuitThemeCallback=function(){scenarii.level1Phase4()}}),addStep(chatDelay,function(){$scope.debug&&jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".theme button").click()}),doSteps()},scenarii.level1Phase4=function(){return $scope.skipCuits=!1,$scope.tooltip.active=!1,verifyCuitThemeCallback=!1,$log.debug(">level1Phase4"),steps=[],selectedCuit.theme===$scope.$storage.chosenTheme?void scenarii.level1Phase5():(verifyCuitThemeCallback=function(){scenarii.level1Phase4()},addChat(chatDelay,"me","Ah... ce Cuitt-là ne m’intéresse pas trop. Attends, j’en cherche un autre !"),addStep(chatDelay,function(){$scope.cuitsHover=!1,$scope.newCuits=!1,addCuit(!1,!0,null,$scope.$storage.chosenTheme)}),addStep(chatDelay,function(){$scope.skipCuits=!0,$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Vérifier la thématique</strong>",$scope.tooltip.position(jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".metas .theme button"),50,20),$scope.tooltip.orientation="top left",$scope.tooltip.active=!0}),addStep(chatDelay,function(){$scope.debug&&jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".theme button").click()}),void doSteps())},scenarii.level1Phase5=function(){$scope.tooltip.active=!1,verifyCuitThemeCallback=!1,$log.debug(">level1Phase5"),steps=[],addChat(chatDelay,"me","Ouah, génial ! C’est super intéressant ce truc&nbsp;!"),addChat(chatDelay,"other","T’as vu ? J’apprends plein d’infos de première fraîcheur depuis que je m’en sers... "),addChat(chatDelay,"other","Bon, il y a aussi des trucs un peu bidon, mais en général, quand tu vérifies qui poste, tu peux savoir si c’est du solide ou pas..."),addChat(chatDelay,"me","Ah ? Comment on fait ça ?"),addChat(chatDelay,"other","Ben, pour voir la fiche de quelqu’un, il faut cliquer sur sa photo d’avatar ou sur son nom d’utilisateur."),addStep(chatDelay,function(){addCuit(!1,!0),addCuit(!1,!0,null,$scope.$storage.chosenTheme),addCuit(!1,!0)}),addChat(chatDelay,"other","Regarde, tu vois le compte qui vient de poster trois messages ? Tu peux cliquer sur sa photo..."),addStep(chatDelay,function(){$scope.skipCuits=!0;var authors=Object.keys(dataService.data.all.sources),author=authors[Math.round(Math.random()*authors.length)];addCuit(!1,!0,author),addCuit(!1,!0,author),addCuit(!1,!0,author)}),addStep(chatDelay,function(){$scope.tooltip.content="Cliquez sur le profil de l'auteur",$scope.tooltip.position(jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".source"),-100,-50),$scope.tooltip.orientation="bottom left",$scope.tooltip.active=!0,openSourceThemeCallback=function(){scenarii.level1Phase6()}}),addStep(chatDelay,function(){$scope.debug&&jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".source").click()}),doSteps()},scenarii.level1Phase6=function(){$scope.tooltip.active=!1,verifyCuitThemeCallback=!1,openSourceThemeCallback=!1,$log.debug(">level1Phase6"),steps=[],addStep(chatDelay,function(){$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Analyser la source</strong>",$scope.tooltip.position(jQuery("#source .metas .theme button"),80,-30),$scope.tooltip.orientation="top left",$scope.tooltip.active=!0,verifySourceThemeCallback=function(){scenarii.level1Phase7()}}),addStep(chatDelay,function(){$scope.debug}),doSteps()},scenarii.level1Phase7=function(){$scope.tooltip.active=!1,verifySourceThemeCallback=!1,$log.debug(">level1Phase7"),steps=[],addChat(chatDelay,"me","Ouah, trop cool !"),addChat(chatDelay,"other","T’as vu ? Analyser une source, ça prend du temps, mais après tu connais la thématique de chacun de ses Cuitts !"),addChat(chatDelay,"me","C’est génial, Cuicuitter ! Ca doit être un super outil pour les journalistes, ça !"),addChat(chatDelay,"other","Carrément !"),addChat(chatDelay,"me","Tiens, mais d’ailleurs... Journaliste... Voilà un métier qui me plairait à fond !"),addChat(chatDelay,"other","Ah ouais ? Cool ! Ben voilà, plus besoin de te prendre la tête, tu sais quoi mettre sur ta fiche d’orientation ! Mais tu vas devoir apprendre à maîtriser Cuicuitter à mort, alors !"),addStep(7e3,function(){updateScore(),showScoring(),tutoAction=null}),doSteps()},scenarii.level2=function(){$log.debug(">scenario2"),tutoAction=!0;var themedSources=[],otherSources=[];angular.forEach(dataService.data.all.sources,function(source,key){source.themes.indexOf($scope.$storage.chosenTheme)>-1&&themedSources.length<5&&themedSources.push(key),-1===source.themes.indexOf($scope.$storage.chosenTheme)&&otherSources.length<5&&otherSources.push(key)}),addCuit(!0,null,null,null,themedSources.concat(otherSources)),$scope.currentChat={contact:"Mehdi",discussion:[]},steps=[],addStep(50,function(){$scope.openWin("cuicuiter")}),addStep(chatDelay,function(){$scope.openWin("chat")}),addChat(chatDelay,"other","Salut !"),addChat(chatDelay,"me","Salut ! Ca roule ?"),addChat(chatDelay,"other","Bien, et toi ? Alors, tu révises le concours pour les écoles de journalisme ?"),addChat(chatDelay,"me","Pfff... M’en parle pas, c’est crevant x_x. En plus, j’ai ouvert un blog pour m’entrainer à écrire des articles..."),addChat(chatDelay,"other","Ah bon ? Un blog ? Cool ! Sur quel sujet&nbsp;?"),addChat(chatDelay,"me","Sur "+$scope.themes[$scope.$storage.chosenTheme]+"."),addChat(chatDelay,"other","Ah, j’aurais dû m’en douter ! C’est super ! Comment tu fais pour trouver des sujets ?"),addChat(chatDelay,"me","J’utilise Cuicuitter ! Mais je dois faire gaffe. Si je veux que mes lecteurs soient contents, j’ai intérêt à choisir des infos sur la bonne thématique..."),addChat(chatDelay,"other","Et comment tu fais pour le savoir ?"),addChat(chatDelay,"me","J’analyse chaque info..."),addChat(chatDelay,"other","Tu peux aussi analyser les sources directement en cliquant sur les photos des utilisateurs, tu sais ?"),addChat(chatDelay,"me","Oui ! C’est vrai, c’est très efficace, même si ça prend plus de temps... Allez, d’ailleurs je te laisse, il faut que je me mette au travail."),addChat(chatDelay,"other","Ok/ Bon courage ;-)"),addStep(2500,function(){$scope.closeWin("chat")}),addStep(500,function(){$scope.tooltip.content="Choisissez des infos dans votre fil Cuicuitter et publiez-les sur votre blog. Attention : choisissez-les bien dans la thématique "+$scope.themes[$scope.$storage.chosenTheme]+". Et faites attention : le temps passe vite ! ",$scope.tooltip.position(jQuery("#cuicuiter"),100,270),$scope.tooltip.orientation="top left",$scope.tooltip.active=!0,$scope.openWin("blog")}),addStep(5e3,function(){$scope.tooltip.active=!1,endTuto()}),addStep(chatDelay,function(){if($scope.debug){for(var i=6,max=10;i&&max;){$log.debug("debug",i,max),addCuit(!1,!0);var cuit=Math.floor(Math.random()*Object.keys($scope.cuits).length);$scope.cuits[cuit].published||($scope.publishCuit($scope.cuits[cuit],!0),i--),max--}scenarii.level2End()}}),doSteps()},scenarii.level2End=function(){$log.debug(">level2End"),showScoring()},scenarii.level3=function(){$log.debug(">scenario3"),tutoAction=!0,$scope.$storage.contacts=[],$scope.$storage.allContacts=[],$scope.$storage.savedContacts?($scope.$storage.contacts=$scope.$storage.savedContacts,$scope.$storage.allContacts=$scope.$storage.savedAllContacts):(addContact(),addContact($scope.$storage.chosenTheme),addContact($scope.$storage.mandatoryTheme),$scope.$storage.savedContacts=$scope.$storage.contacts,$scope.$storage.savedAllContacts=$scope.$storage.allContacts),$scope.currentChat={contact:"Sonia",discussion:[]},steps=[],addStep(50,function(){$scope.openWin("cuicuiter")}),addStep(chatDelay,function(){$scope.openWin("chat")}),addChat(chatDelay,"other","Vous êtes connecté(e) ?"),addChat(chatDelay,"me","Oui, ça y est !"),addChat(chatDelay,"other","Alors je vais vous montrer comment vérifier une info. Commencez par vérifier la thématique d'un cuit."),addStep(chatDelay,function(){addCuit(!1,!0,null,$scope.$storage.chosenTheme),addCuit(!1,!0,null,$scope.$storage.chosenTheme)}),addStep(chatDelay,function(){$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Vérifier la thématique</strong>",$scope.tooltip.position(jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".metas .theme button"),50,20),$scope.tooltip.orientation="top left",$scope.tooltip.active=!0,verifyCuitThemeCallback=function(){$scope.tooltip.active=!1,scenarii.level3Phase2(),verifyCuitThemeCallback=null}}),addStep(chatDelay,function(){$scope.debug&&jQuery("#cuicuiter .cuit").not(".verified-theme").first().find(".theme button").click()}),doSteps()},scenarii.level3Phase2=function(){$log.debug(">scenario3Phase2"),steps=[],addChat(chatDelay,"other","Très bien ! Vous avez vu, ça parle de "+$scope.themes[selectedCuit.theme]+"... Ca pourrait intéresser nos lecteurs ! Mais il faut vérifier que l’info est bien crédible. C’est à ça que sert le nouveau bouton qui vient d’apparaître. Cliquez dessus."),addStep(chatDelay,function(){$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Vérifier la crédibilité</strong>",$scope.tooltip.position(jQuery("#cuicuiter .cuit").not(".verified-credibility").first().find(".metas .credibility button"),50,20),$scope.tooltip.orientation="top left",$scope.tooltip.active=!0,verifyCuitCredibilityCallback=function(){$scope.tooltip.active=!1,scenarii.level3Phase3(),verifyCuitCredibilityCallback=null}}),addStep(chatDelay,function(){$scope.debug&&jQuery("#cuicuiter .cuit").not(".verified-credibility").first().find(".credibility button").click()}),doSteps()},scenarii.level3Phase3=function(){$log.debug(">scenario3Phase3"),steps=[],addStep(50,function(){$scope.openWin("skoupe"),addContact(),$scope.$storage.contacts.length<3&&(addContact(selectedCuit.theme),addContact($scope.$storage.chosenTheme),addContact($scope.$storage.mandatoryTheme))}),$scope.openWin("chat",{position:{left:250,top:250}}),addChat(chatDelay,"other","Pour vérifier une info, vous devez contacter quelqu’un en qui vous avez confiance. J’ai rajouté trois personnes dans votre carnet d’adresses. Mais attention ! Il faut que vous choisissiez un contact qui s’y connaît dans la thématique "+$scope.themes[selectedCuit.theme]+". A vous de jouer !"),addStep(chatDelay,function(){$scope.openWin("skoupe")}),addStep(chatDelay,function(){$scope.tooltip.content="Choisissez un contact, et cliquez sur le bouton 'Appeler'",$scope.tooltip.position(jQuery("#skoupe .inner__body .inner-item").first(),-160,-240),$scope.tooltip.orientation="bottom right",$scope.tooltip.active=!0,callContactCallback=function(){scenarii.level3Phase4()}}),addStep(chatDelay,function(){if($scope.debug){utils.shuffle($scope.$storage.contacts)[0]}}),doSteps()},scenarii.level3Phase4=function(){$log.debug(">scenario3Phase4"),steps=[],-1===selectedContact.themes.indexOf(selectedCuit.theme)?(addChat(chatDelay,"other","Eh non ! Ce contact n’est pas spécialiste de "+$scope.themes[selectedCuit.theme]+". Regardez bien les petites icônes dans la colonne « Thématique » de votre carnet d’adresses. Allez, choisissez un autre contact !"),addStep(chatDelay,function(){$scope.canCall=!0,$scope.openWin("skoupe"),$scope.tooltip.content="Choisissez un contact, et cliquez sur le bouton 'Appeler'",$scope.tooltip.position(jQuery("#skoupe .inner"),0,100),$scope.tooltip.active=!0,callContactCallback=function(){scenarii.level3Phase4()}}),addStep(chatDelay,function(){$scope.debug})):($scope.canCall=!1,$scope.tooltip.active=!1,addChat(chatDelay,"other","Bravo ! Vous voyez, maintenant, vous connaissez la crédibilité de l’info. Il y a quatre niveaux possibles, de 0 étoiles pour une info pas crédible à trois étoiles pour une super info. A vous de décider si vous la publiez ou pas !"),addChat(chatDelay,"me","Je vois... Et je peux demander à mes contacts d’évaluer la crédibilité d’une source ?"),addChat(chatDelay,"other","Bien sûr ! En cliquant sur une photo d’avatar ou sur un nom dans le fil Cuicuitter, vous pourrez vérifier la crédibilité de n’importe qui. Mais il faudra d’abord analyser la source, pour savoir quelles sont ses thématiques préférées."),addChat(chatDelay,"me","Ah... Ca n’a pas l’air facile !"),addChat(chatDelay,"other","Le mieux, c’est d’apprendre en faisant. Alors je vous laisse essayer. N’oubliez pas de publier des infos qui parlent de "+$scope.themes[$scope.$storage.chosenTheme]+" ou de "+$scope.themes[$scope.$storage.mandatoryTheme]+". Bonne journée !"),addStep(2500,function(){$scope.closeWin("chat"),$scope.openWin("blog");var chosenThemedSources=[],mandatoryThemedSources=[],otherSources=[];angular.forEach(dataService.data.all.sources,function(source,key){source.themes.indexOf($scope.$storage.chosenTheme)>-1&&chosenThemedSources.length<5&&chosenThemedSources.push(key),source.themes.indexOf($scope.$storage.mandatoryTheme)>-1&&mandatoryThemedSources.length<5&&mandatoryThemedSources.push(key),-1===source.themes.indexOf($scope.$storage.chosenTheme)&&otherSources.length<8&&otherSources.push(key)}),addCuit(!0,null,null,null,chosenThemedSources.concat(mandatoryThemedSources).concat(otherSources)),$scope.skipCuits=!1,verifyCuitCredibilityCallback=null,callContactCallback=null,endTuto()})),doSteps()},scenarii.level3End=function(){$log.debug(">level3End"),showScoring()},scenarii.level4=function(){$log.debug(">scenario4"),tutoAction=!0,$scope.skipCuits=!0,$scope.currentChat={contact:"Sonia",discussion:[]},steps=[],addStep(50,function(){$scope.openWin("cuicuiter"),$scope.openWin("publish"),$scope.openWin("chat",{position:{left:100,top:300}})}),addStep(50,function(){var i;for(i=0;7>i;i++)addCuit(!1,!0);addCuit(!1,!0,null,null,null,1),$scope.selectedCuit=selectedCuit,addContact(selectedCuit.theme),selectedContact=$scope.$storage.contacts[0],selectedCuit.themeVerified=!0,updateCuitCredibility(!0)}),addStep(chatDelay,function(){scenarii.level4Phase2()}),doSteps()},scenarii.level4Phase2=function(){$log.debug(">scenario4Phase2"),steps=[],addChat(chatDelay,"other","Vous êtes connecté(e) ?"),addChat(chatDelay,"me","C’est bon !"),addChat(chatDelay,"other","Très bien. Alors vous voyez ce gros bloc, en bas à droite ?"),addChat(chatDelay,"me","Absolument..."),addChat(chatDelay,"other","C’est la maquette de notre site Internet. La zone la plus grande, en haut, est l’endroit où on publie l’article de Une – si tu as une super info, il faut absolument la mettre là."),addChat(chatDelay,"me","Mais comment puis-je savoir si..."),addChat(chatDelay,"other","Ne soyez pas impatient ! J’en finis avec la maquette : les deux blocs d’articles moyens, sous la Une, sont réservés à des sujets un peu moins importants. Et les trois petites brèves, sur la droite, c’est pour que toutes les thématiques puissent être représentées, puisqu’il y a 6 emplacements en tout."),addChat(chatDelay,"other","Votre rôle va donc être de remplir ces 6 emplacements avec des infos que vous aurez récupérées sur Cuicuitter... "),addChat(chatDelay,"other","Une fois que la maquette est pleine, vous publiez le tout, et voilà le travail !"),addChat(chatDelay,"me","Bien compris, chef ! Mais comment savoir si une info est plus importante qu’une autre ?"),addChat(chatDelay,"other","D’abord, plus une info est crédible, plus elle est bonne. Et vous savez déjà vérifier la crédibilité d’une info, n’est-ce pas ?"),addChat(chatDelay,"me","Oui chef !"),addChat(chatDelay,"other","Mais surtout, vous devez essayer de trouver des scoops !"),addChat(chatDelay,"me","Des scoops ?"),addChat(chatDelay,"other","Oui ! Des infos exclusives, qu’aucun autre site n’a déjà publiées ?"),addChat(chatDelay,"me","Et comment faire pour savoir si une info est un scoop ?"),addChat(chatDelay,"other","Regardez par exemple ce cuitt : j’ai déjà déterminé qu’il parlait de "+$scope.themes[selectedCuit.theme]+", et que l’info n’était pas très crédible... Maintenant, cliquez sur le bouton qui est apparu en dessous."),addStep(chatDelay,function(){$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Vérifier l'exclusivité</strong>",$scope.tooltip.position(jQuery("#cuicuiter .cuit").not(".verified-exclusivity").first().find(".metas .exclusivity button"),-100,20),$scope.tooltip.orientation="bottom left",$scope.tooltip.active=!0,verifyCuitExclusivityCallback=function(){scenarii.level4Phase3(),verifyCuitExclusivityCallback=null}}),addStep(chatDelay,function(){$scope.debug}),doSteps()},scenarii.level4Phase3=function(){$log.debug(">scenario4Phase3"),steps=[],$scope.tooltip.active=!1,$scope.openWin("skoupe"),addChat(chatDelay,"other","Pour vérifier le niveau d’exclusivité d’une info, vous devez demander de l’aide à vos contacts."),addChat(chatDelay,"me","Ah... Mais le contact que j’ai dans cette thématique semble indisponible."),addChat(chatDelay,"other","Eh oui... C’est parce que c’est à lui que j’ai déjà demandé de vérifier la crédibilité de cette info. Vous ne pouvez pas demander au même contact de vérifier à la fois la crédibilité et l’exclusivité d’une info. Il faut demander à quelqu’un d’autre : ça s’appelle « recouper ses sources » !"),addChat(chatDelay,"me","Très bien... Mais personne d’autre dans mon carnet d’adresses n’est spécialiste de "+$scope.themes[selectedCuit.theme]+" !"),addChat(chatDelay,"other","Dans ce cas, vous allez devoir trouver une nouvelle source ! Pour le faire, cliquez ici..."),addStep(chatDelay,function(){$scope.tooltip.content="Cliquez maintenant sur le bouton <strong>Nouveaux contacts</strong>",$scope.tooltip.position(jQuery("#skoupe #new-contact"),50,-200),$scope.tooltip.orientation="top right",$scope.tooltip.active=!0;var $container=angular.element(document.getElementById("skoupe")),$contactBottom=angular.element(document.getElementById("new-contact"));$container.scrollToElement($contactBottom,30,100),newContactCallback=function(){scenarii.level4Phase4()}}),addStep(chatDelay,function(){$scope.debug}),doSteps()},scenarii.level4Phase4=function(){$log.debug(">scenario4Phase4"),steps=[],$scope.tooltip.active=!1,addChat(chatDelay,"other","Super ! Maintenant, choisissez la thématique "+$scope.themes[selectedCuit.theme]+" dans la liste."),addStep(2500,function(){$scope.selectedTheme=selectedCuit.theme,$scope.openWin("themeSelector"),$scope.themeSelectorAction=function(){addContact($scope.selectedTheme),$scope.closeWin("themeSelector"),$scope.themeSelectorAction=null,scenarii.level4Phase5()}}),addStep(chatDelay,function(){$scope.debug&&$scope.themeSelectorAction()}),doSteps()},scenarii.level4Phase5=function(){$log.debug(">scenario4Phase5"),steps=[],$scope.tooltip.active=!1,addChat(chatDelay,"other","Et voilà ! Vous avez maintenant un nouveau contact ! Vous pouvez vous en servir pour vérifier l’exclusivité de l’info !"),addStep(chatDelay,function(){$scope.tooltip.content="Appelez votre contact",$scope.tooltip.position(jQuery("#skoupe"),-50,-150),$scope.tooltip.orientation="bottom right",$scope.tooltip.active=!0,callContactCallback=function(){scenarii.level4Phase6(),callContactCallback=null}}),addStep(chatDelay,function(){$scope.debug&&$scope.callContact($scope.$storage.contacts[0])}),doSteps()},scenarii.level4Phase6=function(){$log.debug(">scenario4Phase6"),steps=[],$scope.tooltip.active=!1,addChat(chatDelay,"other","Vous voyez : votre nouveau contact est formel : cette info n’est pas un scoop. Et en plus elle n’est pas crédible !"),addChat(chatDelay,"me","D’accord. Mais si je voulais la publier..."),addChat(chatDelay,"other","Tu n’aurais qu’à cliquer sur le bouton « publier », en dessous du cuitt, et à choisir l’emplacement que tu veux dans la maquette."),addChat(chatDelay,"other","Mais si vous publiez une info peu crédible, qui EN PLUS n’est pas un scoop... vous êtes VIRÉ !"),addChat(chatDelay,"other","Ah, et si vous vous avisez de vous moquer de mon chat Grumphy en fond d'écran, VOUS ETES VIRE AUSSI !"),addChat(chatDelay,"me","Ah..."),addChat(chatDelay,"other","Et n’oubliez pas : il faut remplir les 6 emplacements de la maquette, si possible avec des infos qui concernent les 6 thématiques différentes !"),addChat(chatDelay,"other","Bon allez, je vous laisse, j’arrive à l’aéroport. A moi les plages de sable fin et les cocktails ! Youhou !!!"),addChat(chatDelay,"me","Mais attendez, je..."),addChat(chatDelay,"other","déconnexion"),addChat(chatDelay,"me","Ah. On dirait bien que je vais devoir me débrouiller seul(e) !"),addStep(2500,function(){$scope.closeWin("chat"),addCuit(!0),endTuto()}),doSteps()},scenarii.level4End=function(){$log.debug(">level4End"),showScoring()};var fakes={};fakes.level2=function(){$log.debug("fakes.level2"),$scope.openWin("cuicuiter"),$scope.openWin("blog");for(var i=0;6>i;i++)addCuit();steps=[],i=20;for(var max=40;i&&max;){$log.debug("fakes",i,max),addCuit(!1,!0);var cuit=Math.floor(Math.random()*Object.keys($scope.cuits).length);$scope.cuits[cuit].published||($scope.publishCuit($scope.cuits[cuit],!0),i--),max-=1}doSteps()},fakes.level3=function(){$log.debug("fakes.level3"),$scope.openWin("cuicuiter"),$scope.openWin("blog");for(var i=0;6>i;i++)addCuit();steps=[],i=6;for(var max=10;i&&max;){addCuit(!1,!0);var cuit=Math.floor(Math.random()*Object.keys($scope.cuits).length);$scope.cuits[cuit].published||($scope.publishCuit($scope.cuits[cuit],!0),i--),max--}doSteps(),showScoring()},fakes.level4=function(){$log.debug("fakes.level4"),$scope.score=2e3,$scope.openWin("cuicuiter"),$scope.openWin("publish");for(var i=0;6>i;i++)addCuit();steps=[],i=6;for(var max=10;i&&max;){addCuit(!1,!0);var cuit=Math.floor(Math.random()*Object.keys($scope.cuits).length);$scope.cuits[cuit].published||($scope.publishCuit($scope.cuits[cuit],!0),i--),max--}addStep(1500,function(){var post=utils.shuffle(jQuery(".grid-block__item"))[0];jQuery(post).find(".down").click()}),doSteps(),showScoring()};var plays={};plays.level2=function(){$log.debug("plays.level2"),$scope.openWin("cuicuiter"),$scope.openWin("blog");var themedSources=[],otherSources=[];angular.forEach(dataService.data.all.sources,function(source,key){source.themes.indexOf($scope.$storage.chosenTheme)>-1&&themedSources.length<5&&themedSources.push(key),-1===source.themes.indexOf($scope.$storage.chosenTheme)&&otherSources.length<5&&otherSources.push(key)}),addCuit(!0,null,null,null,themedSources.concat(otherSources))},plays.level3=function(){$log.debug("plays.level3"),$scope.openWin("cuicuiter"),$scope.openWin("skoupe"),$scope.$storage.contacts=[],$scope.$storage.allContacts=[],$scope.$storage.savedContacts?($scope.$storage.contacts=$scope.$storage.savedContacts,$scope.$storage.allContacts=$scope.$storage.savedAllContacts):(addContact(),addContact($scope.$storage.chosenTheme),addContact($scope.$storage.mandatoryTheme),$scope.$storage.savedContacts=$scope.$storage.contacts,$scope.$storage.savedAllContacts=$scope.$storage.allContacts),$log.debug($scope.$storage.contacts),$scope.openWin("blog");var chosenThemedSources=[],mandatoryThemedSources=[],otherSources=[];angular.forEach(dataService.data.all.sources,function(source,key){source.themes.indexOf($scope.$storage.chosenTheme)>-1&&chosenThemedSources.length<5&&chosenThemedSources.push(key),source.themes.indexOf($scope.$storage.mandatoryTheme)>-1&&mandatoryThemedSources.length<5&&mandatoryThemedSources.push(key),-1===source.themes.indexOf($scope.$storage.chosenTheme)&&otherSources.length<8&&otherSources.push(key)}),$log.debug(chosenThemedSources.concat(mandatoryThemedSources).concat(otherSources)),$log.debug(chosenThemedSources.concat(mandatoryThemedSources).concat(otherSources).length),addCuit(!0,null,null,null,chosenThemedSources.concat(mandatoryThemedSources).concat(otherSources))},plays.level4=function(){$log.debug("plays.level3"),$scope.openWin("cuicuiter"),$scope.openWin("skoupe"),$scope.openWin("publish"),addCuit(!0)},$scope.posts=[],$scope.publishCuit=function(cuit,force){cuit.published||checkRemainingTime("publish-cuit")&&(force?doPublishCuit(cuit,!0):(promptCallback=function(){doPublishCuit(cuit)},$scope.promptContent="Êtes-vous sûr de vouloir publier ce Cuit ?",$scope.openWin("prompt")))},$scope.unpublish=function(post){$scope.currentPost=post,checkRemainingTime("unpublish-cuit")&&(promptCallback=function(){$log.debug("unpublish(",$scope.currentPost.cuit.id),angular.forEach($scope.cuits,function(c,idx){c.id===post.cuit.id&&($scope.cuits[idx].published=!1)}),angular.forEach($scope.posts,function(p,idx){p.cuit.id===$scope.currentPost.cuit.id&&($scope.posts.splice(idx,1),decrementTime("unpublish-cuit","publish"),updateScore())}),$scope.closeWin("prompt"),promptCallback=null},$scope.promptContent="Êtes-vous sûr de vouloir dépublier cet article ?",$scope.openWin("prompt"),addStep(chatDelay,function(){$scope.debug&&jQuery("#prompt .confirm").click()}))},$scope.publishDown=function(pos){if($log.debug("publishDown(",pos),pos<$scope.posts.length-1){var tmp=$scope.posts[pos+1];$scope.posts[pos+1]=$scope.posts[pos],$scope.posts[pos]=tmp,updateScore()}},$scope.publishUp=function(pos){$log.debug("publishUp(",pos);var tmp=$scope.posts[pos-1];$scope.posts[pos-1]=$scope.posts[pos],$scope.posts[pos]=tmp,updateScore()},$scope.feedback={status:null,active:!1,type:null},$scope.endDay=function(){promptCallback=function(){$log.debug("endDay"),$scope.closeWin("prompt"),promptCallback=null,doEndDay()},$scope.promptContent="Êtes-vous sûrs de vouloir terminer votre journée ?",$scope.openWin("prompt")},$timeout(function(){$log.debug($scope.fake),$log.debug($scope.chosenTheme),updateScore(),$scope.fake?fake():$scope.skip?play():scenario()},500)}]),angular.module("newsGameApp").controller("OutroCtrl",["$rootScope","$scope","$routeParams","$log","$location","$timeout","$interval","$q","dataService","titleService","Xiti","Sound","utils","$localStorage",function($rootScope,$scope,$routeParams,$log,$location,$timeout,$interval,$q,dataService,titleService,Xiti,Sound,utils,$localStorage){function showText(content){$log.debug("showText(",content);var deferred=$q.defer(),contentIdx=0;$scope.typed="",$scope.skipText=1;var interval=$interval(function(){0===$scope.skipText&&($scope.typed=$scope.typed+content[contentIdx],contentIdx+=1,contentIdx===content.length&&$scope.skipText++),1===$scope.skipText&&($scope.typed=content,$scope.skipText=2,$timeout(function(){$scope.skipText=3},chatDelay*delayModifier)),3===$scope.skipText&&($interval.cancel(interval),deferred.resolve())},chatInterval*delayModifier);return deferred.promise}$log.debug("Outro"),titleService.setTitle("Outro"),Sound.init(),Sound.play("introText"),$scope.debug=$routeParams.debug,$scope.$storage=$localStorage.$default({level:1,scores:{}}),Xiti.click(null,"Serious Game::outro::level-"+$scope.$storage.level);var chatDelay=dataService.data.settings.chatDelay,chatInterval=dataService.data.settings.chatInterval,delayModifier=$scope.debug?.1:2;$log.debug($scope.$storage.level),$log.debug($scope.$storage.scores),$log.debug($scope.$storage.posts),$log.debug($scope.$storage.scoreStatus),$rootScope.background="intro-level-"+$scope.$storage.level,$scope.showScore=function(){$location.path("/score")};var outro={};outro.level1=function(){$location.path("/score")},outro.level2=function(){var text;$scope.character="Daniel3",$scope.characterName="Mehdi",text="defeat"===$scope.$storage.scoreStatus?$scope.$storage.posts.length<4?"Pas mal ton blog,... mais y a pas assez d'info. Faut te secouer un peu ! Maintenant c'est l'heure de réviser tes cours, non ? Mais ne lâche pas l'affaire, tu feras mieux demain ! ":"Tu espères faire une grande carrière de journaliste en publiant autant d'anêries ? Le moins que l'on puisse dire, c'est que tes lecteurs n'apprécient pas ton manque de sérieux ! Allez, oublie cette mauvaise journée et essaye de faire mieux demain !":"Bravo ! Tu as montré ton talent pour sélectionner des informations ! C'est la base du métier de journaliste. Mais certaines informations sont plus crédibles que d'autres... Sauras-tu les détecter ?",showText(text).then(function(){$timeout(function(){$location.path("/score")},2500)})},outro.level3=function(){var text;$scope.characterName="Sonia","defeat"===$scope.$storage.scoreStatus?$scope.$storage.posts.length<4?($scope.character="SoniaA4",text="Vous n'avez pas publié assez de bonnes infos aujourd'hui, et maintenant c'est l'heure de rentrer chez vous. Allez, rentrez chez vous... et réessayez demain !"):($scope.character="SoniaA5",text="Vous espérez faire une grande carrière de journaliste en publiant autant d'anêries ? Le moins que l'on puisse dire, c'est que je ne suis pas de cet avis ! Allez, oubliez cette mauvaise journée et essayez de faire mieux demain !"):($scope.character="SoniaA2",text="Bravo ! Vous êtes vigilant : avec vous, pas question de publier n'importe quoi ! Et vos lecteurs aiment ça ! Vous commencez à être un journaliste confirmé. Mais si vous étiez aux commandes, sauriez vous détecter les scoops et choisir quelles infos mettre en avant sur votre site ?"),showText(text).then(function(){$timeout(function(){$location.path("/score")
},2500)})},outro.level4=function(){var text,totalScore=$scope.$storage.scores["level-1"]+$scope.$storage.scores["level-2"]+$scope.$storage.scores["level-3"]+$scope.$storage.scores["level-4"];$scope.characterName="Sonia","defeat"===$scope.$storage.scoreStatus?($scope.character="SoniaB5",text="Oups.... On dirait que les subtilités du travail de rédacteur en chef vous échappent encore... Normal : ce n'est pas facile de sélectionner, de vérifier et de hiérarchiser l'information ! Si vous ne voulez pas que je revienne précipitemment de vacances pour mettre les points sur les i, vous devriez tenter à nouveau l'aventure..."):totalScore>dataService.data.settings.scoring["excellent-score"]?($scope.characterName=null,$scope.albert=!0):text="Félicitations ! Vous maîtrisez tous les rouages du métier de journaliste : vous êtes capable de sélectionner, de vérifier et de hiérarchiser l'information. Mais... Vous avez comme la vague impression que vous auriez pu faire ENCORE mieux... ",text&&showText(text).then(function(){$timeout(function(){$location.path("/score")},2500)})},"albert"===$routeParams.debug?($scope.characterName=null,$scope.albert=!0):outro["level"+$scope.$storage.level]&&outro["level"+$scope.$storage.level]()}]),angular.module("newsGameApp").controller("ScoreCtrl",["$rootScope","$scope","$routeParams","$log","$location","$timeout","$interval","$q","dataService","titleService","Xiti","Sound","utils","$localStorage",function($rootScope,$scope,$routeParams,$log,$location,$timeout,$interval,$q,dataService,titleService,Xiti,Sound,utils,$localStorage){$log.debug("Score"),Sound.init(),titleService.setTitle("Score"),$scope.debug=$routeParams.debug,$scope.$storage=$localStorage.$default({level:1,scores:{}}),Xiti.click(null,"Serious Game::score::level-"+$scope.$storage.level),$rootScope.background="intro-level-"+$scope.$storage.level,$scope.scoring=dataService.data.settings.scoring["level-"+$scope.$storage.level],$scope.themes=dataService.data.all.themes,$log.debug($scope.$storage.level),$log.debug($scope.$storage.scores),$log.debug($scope.$storage.scoreStatus),$log.debug($scope.$storage.posts),$log.debug($scope.scoring),"defeat"===$scope.$storage.scoreStatus&&Sound.play("endLoose"),"victory"===$scope.$storage.scoreStatus&&Sound.play($scope.$storage.level<4?"endWin":"endGame"),$scope.nextLevel=function(){Sound.play("click"),$scope.$storage.level=parseInt($scope.$storage.level,10)+1,$location.path("/intro")},$scope.playAgain=function(){Sound.play("click"),$log.debug("playAgain"),$location.path("/play")},$scope.shareScore=function(type,extra){var text,url="http://education.francetv.fr/serious-game/chasseurs-d-info-deviendrez-vous-le-redacteur-en-chef-de-demain-o12345",score=$scope.$storage.scores["level-1"]+$scope.$storage.scores["level-2"]+$scope.$storage.scores["level-3"]+$scope.$storage.scores["level-4"];return text=extra?"Journaliste en formation à Chasseur d'infos, j'ai réalisé un score de "+score+" points. Et vous ?":"Chasseur d'infos / En tant que rédacteur en chef de l'International, j'ai réalisé un score de "+score+" points. Et vous ?","twitter"===type&&window.open("https://twitter.com/share?url="+url+"&text="+encodeURI(text),"sharetwitter","status=1,width=600,height=400,scrollbars=no"),"facebook"===type&&window.open("http://www.facebook.com/sharer.php?u="+url+"&text="+encodeURI(text),"sharefacebook","status=1,width=600,height=400,scrollbars=no"),!1}}]),angular.module("newsGameApp").factory("Xiti",["config","$log","prod","$timeout",function(config,$log,prod,$timeout){return{click:function(e,xtpage){window.xt_click?window.xt_click(document,"F",9,"jaujard::"+xtpage):$timeout(function(){window.xt_click(document,"F",9,"jaujard::"+xtpage)},1e3)}}}]),angular.module("newsGameApp").factory("Sound",["config","$log","prod",function(config,$log,prod){return{muteDev:!0,sounds:{},playing:null,muted:!1,extension:"mp3",init:function(){if($log.debug("Sound.init(), prod : ",prod),buzz.defaults.formats=["ogg","mp3","aac"],prod||!this.muteDev){$log.debug("buzz.isSupported",buzz.isSupported()),buzz.isOGGSupported()&&(this.extension="ogg"),buzz.isAACSupported()&&(this.extension="aac"),$log.debug("Sound.extension",this.extension);var sounds=this.sounds;angular.forEach(config.sounds,function(value,key){$log.debug(value),sounds[key]||(sounds[key]=new buzz.sound(value))}),this.sounds=sounds}},play:function(sound,bgd){if($log.debug("Sound.play(",sound,bgd),prod||!this.muteDev){if(bgd){if(this.playing!==sound)if(this.playing){var sounds=this.sounds;this.sounds[this.playing].fadeOut(1e3,function(){sounds[sound].loop().play().fadeIn(1e3)})}else this.sounds[sound].loop().play().fadeIn(1e3)}else this.sounds[sound].play();this.playing=sound}},toggleMute:function(){$log.debug("toggleMute"),this.playing&&($log.debug("playing"),this.muted?($log.debug("muted"),this.sounds[this.playing].fadeIn(1e3),this.muted=!1,jQuery("#footer-tools__item--unmute").hide(),jQuery("#footer-tools__item--mute").show()):($log.debug("not mtued"),$log.debug(this.sounds[this.playing]),this.sounds[this.playing].stop(),this.muted=!0,jQuery("#footer-tools__item--mute").hide(),jQuery("#footer-tools__item--unmute").show()))}}}]);